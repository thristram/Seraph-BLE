<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CSR ÂµEnergy&reg; Firmware: Timers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.2 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>Timers<br/>
<small>
[<a class="el" href="group__SYS.html">System</a>]</small>
</h1>  </div>
</div>
<div class="contents">
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gae496c36ae7b66d62a5fec0cc288e353f"></a><!-- doxytag: member="TIMER::TIMER_INVALID" ref="gae496c36ae7b66d62a5fec0cc288e353f" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__TIMER.html#gae496c36ae7b66d62a5fec0cc288e353f">TIMER_INVALID</a>&#160;&#160;&#160;0</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Invalid Timer ID. E.g. this value is returned if a timer cannot be created. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__TIMER.html#ga25ec286db89364ba900e278b73d273ff">SIZEOF_APP_TIMER</a>&#160;&#160;&#160;6</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Size of structure for a single timer. See <a class="el" href="group__TIMER.html#gaf9c004d5a45eefa2e9355b94e5309b5b" title="Initialise the application timers.">TimerInit</a> for details on how to use this value.  <a href="#ga25ec286db89364ba900e278b73d273ff"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga9f1299c5dd88c76fb0cbd828d801c4ec"></a><!-- doxytag: member="TIMER::MAX_TIMER_PERIOD" ref="ga9f1299c5dd88c76fb0cbd828d801c4ec" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__TIMER.html#ga9f1299c5dd88c76fb0cbd828d801c4ec">MAX_TIMER_PERIOD</a>&#160;&#160;&#160;(35 * MINUTES)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The maximum period a timer can be set for. <br/></td></tr>
<tr><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef uint16&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__TIMER.html#gac25996b7bdf46a66a8febc810b484fb8">timer_id</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Opaque type used to reference a timer.  <a href="#gac25996b7bdf46a66a8febc810b484fb8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__TIMER.html#ga0406f912c46c8c9465c9661b47d4116b">timer_callback_arg</a> )(<a class="el" href="group__TIMER.html#gac25996b7bdf46a66a8febc810b484fb8">timer_id</a> const )</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Timer expiry call back function type.  <a href="#ga0406f912c46c8c9465c9661b47d4116b"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__TIMER.html#gaf9c004d5a45eefa2e9355b94e5309b5b">TimerInit</a> (uint16 max_timers, void *timer_array)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialise the application timers.  <a href="#gaf9c004d5a45eefa2e9355b94e5309b5b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__TIMER.html#gac25996b7bdf46a66a8febc810b484fb8">timer_id</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__TIMER.html#ga9b91772f0621a1517a99db4bd560fd9b">TimerCreate</a> (uint32 const time, bool const relative, <a class="el" href="group__TIMER.html#ga0406f912c46c8c9465c9661b47d4116b">timer_callback_arg</a> handler)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Insert an application timer into the timer queue.  <a href="#ga9b91772f0621a1517a99db4bd560fd9b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__TIMER.html#gaf1c4ab6723e7f6ebb21374f65d391ea5">TimerDelete</a> (<a class="el" href="group__TIMER.html#gac25996b7bdf46a66a8febc810b484fb8">timer_id</a> const tid)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Delete a timer from the queue.  <a href="#gaf1c4ab6723e7f6ebb21374f65d391ea5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__TIMER.html#gae5fd58062960211c0070ed8b5b8fd899">AppBackgroundTick</a> (bool enable)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Enable or disable the Application Background Tick event.  <a href="#gae5fd58062960211c0070ed8b5b8fd899"></a><br/></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ga25ec286db89364ba900e278b73d273ff"></a><!-- doxytag: member="timer.h::SIZEOF_APP_TIMER" ref="ga25ec286db89364ba900e278b73d273ff" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIZEOF_APP_TIMER&#160;&#160;&#160;6</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Size of structure for a single timer. See <a class="el" href="group__TIMER.html#gaf9c004d5a45eefa2e9355b94e5309b5b" title="Initialise the application timers.">TimerInit</a> for details on how to use this value. </p>

</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="ga0406f912c46c8c9465c9661b47d4116b"></a><!-- doxytag: member="timer.h::timer_callback_arg" ref="ga0406f912c46c8c9465c9661b47d4116b" args=")(timer_id const )" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void( * <a class="el" href="group__TIMER.html#ga0406f912c46c8c9465c9661b47d4116b">timer_callback_arg</a>)(<a class="el" href="group__TIMER.html#gac25996b7bdf46a66a8febc810b484fb8">timer_id</a> const )</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Timer expiry call back function type. </p>

</div>
</div>
<a class="anchor" id="gac25996b7bdf46a66a8febc810b484fb8"></a><!-- doxytag: member="timer.h::timer_id" ref="gac25996b7bdf46a66a8febc810b484fb8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef uint16 <a class="el" href="group__TIMER.html#gac25996b7bdf46a66a8febc810b484fb8">timer_id</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Opaque type used to reference a timer. </p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="gae5fd58062960211c0070ed8b5b8fd899"></a><!-- doxytag: member="timer.h::AppBackgroundTick" ref="gae5fd58062960211c0070ed8b5b8fd899" args="(bool enable)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AppBackgroundTick </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"> <em>enable</em>&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Enable or disable the Application Background Tick event. </p>
<p>The Background Tick event is generated via the firmware internal watchdog timer (although at a lower priority). Therefore one event will be sent to the application for each watchdog tick. The tick rate is defined by the Configuration Store "Watchdog period" key.</p>
<p>One advantage of using the Background Tick rather than running a separate application timer is that the number of times the chip has to wake from Deep Sleep can be minimised (as the firmware watchdog processing and application Background Tick processing will occur during the same wakeup period). If the application does not require to perform "background" processing as often as the watchdog period, it could use a simple counter to skip some Background Tick events.</p>
<p>The Background Tick is presented to the application as a regular event (SYS_BACKGROUND_TICK_IND) to the <a class="el" href="group__APP.html#gae2c57d9a44f753089d9ea0ac5b1a7a09" title="called whenever a LM-specific event is received by the system.">AppProcessLmEvent()</a> event handler.</p>
<p>By default when the system powers up the Background Tick is disabled. The application can enable or disable the tick whenever it needs it.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">enable</td><td>TRUE to enable the tick event; FALSE to disable the tick event</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Nothing </dd></dl>

</div>
</div>
<a class="anchor" id="ga9b91772f0621a1517a99db4bd560fd9b"></a><!-- doxytag: member="timer.h::TimerCreate" ref="ga9b91772f0621a1517a99db4bd560fd9b" args="(uint32 const time, bool const relative, timer_callback_arg handler)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__TIMER.html#gac25996b7bdf46a66a8febc810b484fb8">timer_id</a> TimerCreate </td>
          <td>(</td>
          <td class="paramtype">uint32 const &#160;</td>
          <td class="paramname"> <em>time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool const &#160;</td>
          <td class="paramname"> <em>relative</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__TIMER.html#ga0406f912c46c8c9465c9661b47d4116b">timer_callback_arg</a>&#160;</td>
          <td class="paramname"> <em>handler</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Insert an application timer into the timer queue. </p>
<p>The timeout period is measured in microseconds. <a class="el" href="time_8h.html" title="Application interface to System Time.">time.h</a> defines a number of constants for <a class="el" href="group__TIME.html#ga6f1e731907521317e8a272d5ae57364e" title="Time constant expressing one millisecond in system time units.">MILLISECOND</a>, <a class="el" href="group__TIME.html#ga94212be2394d2d37d9dfd33d07d82dba" title="Time constant expressing one second in system time units.">SECOND</a> and <a class="el" href="group__TIME.html#gac1454fa04f41c693f39425697a137d82" title="Time constant expressing one minute in system time units.">MINUTE</a>, e.g. allowing 10*SECOND to be used when starting a timer. Note that although the timeout value is a 32-bit number the maximum timeout period is actually 35 minutes to enable safe 'roll over' handling. <a class="el" href="group__TIMER.html#ga9f1299c5dd88c76fb0cbd828d801c4ec" title="The maximum period a timer can be set for.">MAX_TIMER_PERIOD</a> defines this value.</p>
<p>When the timer expires, the firmware will call the application timer handler function. Prior to calling the handler, the firmware will have "cleaned up" the timer structure, therefore the application does not need to manually delete the timer. If the application needs to restart the timer (for the same or a different duration) it can simply call <a class="el" href="group__TIMER.html#ga9b91772f0621a1517a99db4bd560fd9b" title="Insert an application timer into the timer queue.">TimerCreate()</a> again.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">time</td><td>The number of microseconds the timer should run for. </td></tr>
    <tr><td class="paramname">relative</td><td>True =&gt; time is offset from "now". </td></tr>
    <tr><td class="paramname">handler</td><td>Pointer to the expiry callback function.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Timer reference, or TIMER_INVALID if the timer could not be started. </dd></dl>

</div>
</div>
<a class="anchor" id="gaf1c4ab6723e7f6ebb21374f65d391ea5"></a><!-- doxytag: member="timer.h::TimerDelete" ref="gaf1c4ab6723e7f6ebb21374f65d391ea5" args="(timer_id const tid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TimerDelete </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__TIMER.html#gac25996b7bdf46a66a8febc810b484fb8">timer_id</a> const &#160;</td>
          <td class="paramname"> <em>tid</em>&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Delete a timer from the queue. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">tid</td><td>Timer reference.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Nothing </dd></dl>

</div>
</div>
<a class="anchor" id="gaf9c004d5a45eefa2e9355b94e5309b5b"></a><!-- doxytag: member="timer.h::TimerInit" ref="gaf9c004d5a45eefa2e9355b94e5309b5b" args="(uint16 max_timers, void *timer_array)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TimerInit </td>
          <td>(</td>
          <td class="paramtype">uint16&#160;</td>
          <td class="paramname"> <em>max_timers</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"> <em>timer_array</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialise the application timers. </p>
<p>This function is used by the application to set up an array of timers. The Firmware library uses this array to manage timers on behalf of the application.</p>
<dl class="warning"><dt><b>Warning:</b></dt><dd>It is the responsibility of the application to ensure that the size of the array pointed to by timer_array is big enough to hold all the timer data required by the firmware. This size is <a class="el" href="group__TIMER.html#ga25ec286db89364ba900e278b73d273ff" title="Size of structure for a single timer. See TimerInit for details on how to use this value...">SIZEOF_APP_TIMER</a> * max_timers.</dd></dl>
<p>A typical use of this function in an application would be as follows:</p>
<div class="fragment"><pre class="fragment">

#define MAX_APP_TIMERS       2
     ...
static uint16 app_timers[ SIZEOF_APP_TIMER * MAX_APP_TIMERS ];
     ...
void AppInit(...)
{
    // Initialise application timers as soon as possible
    TimerInit(MAX_APP_TIMERS, (void*)app_timers);
    ...
    // The init function can start a timer now if it desires
    TimerCreate( ... );

</pre></div><p>The application is not allowed to have more timers running concurrently than were originally provided. If no timers are left then TimerCreate will return TIMER_INVALID.</p>
<p><a class="el" href="group__TIMER.html#gaf9c004d5a45eefa2e9355b94e5309b5b" title="Initialise the application timers.">TimerInit()</a> can only be called once after power-up. It is not possible to re-initialise the application timers without performing a device reset.</p>
<dl class="warning"><dt><b>Warning:</b></dt><dd>The application MUST not modify the contents of the array at any time after calling <a class="el" href="group__TIMER.html#gaf9c004d5a45eefa2e9355b94e5309b5b" title="Initialise the application timers.">TimerInit()</a>.</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">max_timers</td><td>Maximum number of application timers available. </td></tr>
    <tr><td class="paramname">timer_array</td><td>Fixed-length array to hold timer information.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Nothing. </dd></dl>

</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Wed Jun 22 2016 11:39:14 for CSR ÂµEnergy&reg; Firmware by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
